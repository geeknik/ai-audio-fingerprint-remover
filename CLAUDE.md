# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

AI Audio Fingerprint Remover is a Python-based defensive security tool designed to remove AI-generated fingerprints, watermarks, and metadata from audio files. The tool implements multiple detection and removal techniques to address privacy concerns while preserving audio quality.

**Key Purpose**: Privacy protection through comprehensive AI fingerprint removal from audio files generated by platforms like Suno, OpenAI, ElevenLabs, and others.

**Performance Highlights**:
- **43x improvement** in watermark detection (258+ watermarks vs 6 previously)
- State-of-the-art removal techniques with psychoacoustic processing
- Secure-by-design implementation with comprehensive validation

## Architecture

### Core Processing Components

- **ai_audio_fingerprint_remover.py**: Main entry point with comprehensive multi-layered fingerprint removal
- **aggressive_watermark_remover.py**: Specialized aggressive removal techniques with multi-band spectral gating
- **sota_watermark_remover.py**: State-of-the-art removal algorithms using cutting-edge techniques

### Enhanced Components

- **integrated_system.py**: Integrated watermark removal system combining multiple approaches
- **next_gen_remover.py**: Next-generation removal techniques with advanced algorithms
- **performance_optimizer.py**: Performance optimization layer for efficient processing

### Detection & Analysis Tools

- **enhanced_suno_detector.py**: Suno-specific watermark detection with neural network-inspired pattern recognition
- **neural_watermark_detector.py**: Neural network-based watermark detection system
- **advanced_steganography_detector.py**: Advanced steganography detection capabilities
- **advanced_watermark_analysis.py**: Comprehensive watermark pattern analysis with detailed frequency band examination

### Testing & Validation

- **watermark_effectiveness_tester.py**: Framework for validating removal effectiveness with quality metrics
- **watermark_comparison.py**: Compares original and processed audio to verify watermark removal
- **test_all_methods.py**: Comprehensive test suite that runs all removal methods
- **test_fixes.py**: Tests for recent bug fixes and improvements
- **quick_comparison.py**: Quick comparison tool for fast analysis

### Processing Pipeline

The tool implements a 4-pass approach:
1. **Metadata Stripping**: Complete removal of standard and custom tags
2. **Spectral Analysis**: Watermark detection and targeted filtering
3. **Statistical Normalization**: Machine-like pattern correction
4. **Human-like Imperfections**: Addition of subtle variations

### Key Libraries

- **librosa>=0.9.0**: Audio analysis and processing
- **scipy>=1.7.0**: Signal processing and filtering
- **numpy>=1.20.0**: Numerical operations
- **soundfile>=0.10.3**: Audio I/O operations
- **mutagen>=1.45.0**: Metadata manipulation
- **matplotlib>=3.4.0**: Visualization (optional)

## Development Commands

### Environment Setup
```bash
# Create and activate virtual environment
python3 -m venv venv && source venv/bin/activate

# Install dependencies
pip install -r requirements.txt
```

### Running the Tool
```bash
# Basic usage
python ai_audio_fingerprint_remover.py input.wav output.wav

# Processing levels
python ai_audio_fingerprint_remover.py input.wav output.wav --level [gentle|moderate|aggressive|extreme]

# In-place processing
python ai_audio_fingerprint_remover.py input.wav

# Directory processing
python ai_audio_fingerprint_remover.py --directory input_folder output_folder

# With verification and reporting
python ai_audio_fingerprint_remover.py input.wav output.wav --verify --report

# View metadata before removal
python ai_audio_fingerprint_remover.py --show input.wav output.wav
```

### Advanced Analysis
```bash
# Analyze watermark patterns in detail
python advanced_watermark_analysis.py "suno_song.mp3" --output "analysis_report.txt"

# Enhanced Suno detection
python enhanced_suno_detector.py "suno_song.mp3"

# Quick comparison
python quick_comparison.py input.wav
```

### Testing
```bash
# Run comprehensive test suite
python test_all_methods.py

# Effectiveness testing
python watermark_effectiveness_tester.py "original.mp3" "processed.mp3" --output "effectiveness_report.txt"

# Test fixes
python test_fixes.py
```

## File Structure

### Main Scripts
- Core processing tools implement the AudioProcessor class with chunked processing
- Each script supports command-line operation with comprehensive argument parsing
- Memory-aware processing with adaptive caching for large files

### Test Files
- Various `.wav` output files represent test results from different processing methods
- `test_all_methods.py` provides comprehensive testing across all removal techniques
- `watermark_effectiveness_tester.py` validates removal effectiveness

### Configuration
- Processing intensity levels: gentle, moderate, aggressive, extreme
- Configurable via command-line arguments
- Memory usage and performance monitoring built-in

## Important Notes

### Suno AI Detection Specifics
The tool targets 7 specific frequency ranges for Suno watermarks:
- 19000-20000 Hz (Ultrasonic watermark)
- 15000-16000 Hz (Mid-high watermark)
- 8000-8200 Hz (Mid-range marker)
- 50-150 Hz (Low-freq steganography)
- 12000-12100 Hz (Secondary marker)
- 17500-18500 Hz (Extended range)
- 22000-23000 Hz (Extended ultrasonic)

### Security Considerations
- This is a defensive security tool for privacy protection
- All processing occurs locally - no external data transmission
- Tool is designed for legitimate privacy protection, not circumventing copyright
- Secure-by-design implementation with input validation and error handling

### Performance
- Implements chunked processing for memory efficiency
- 30% faster processing with 40% less memory usage for large files
- Adaptive filtering based on file characteristics
- Built-in performance monitoring

### Quality vs. Effectiveness Trade-offs
- **Gentle**: Minimal processing, preserves quality but may leave some fingerprints
- **Moderate**: Balanced approach (default)
- **Aggressive**: Thorough fingerprint removal with minimal quality impact (recommended for Suno)
- **Extreme**: Maximum fingerprint removal, may introduce subtle artifacts

### Effectiveness Metrics
Typical results for Suno files:
- Watermark Removal: 85-95/100
- Quality Preservation: 75-85/100
- Perceptual Preservation: 80-90/100
- Overall Score: 80-90/100 (Excellent effectiveness)

## Recent Fixes Applied

### Critical Issues Resolved
1. **Silent Output Fix**: Fixed `np.zeros_like()` initialization that created silent outputs
2. **NaN/Inf Handling**: Replaced aggressive `nan_to_num()` with safe interpolation
3. **Audio Validation**: Added validation checks before file writing to prevent silent outputs
4. **Filter Length Issues**: Fixed filter order calculations to prevent processing failures
5. **AI Detection Bypass**: Enhanced pattern disruption techniques for better evasion

### Audio Processing Improvements
- Fallback mechanisms to preserve original audio if processing fails
- Conservative filtering strengths to maintain audio quality
- Enhanced stereo channel processing with per-channel validation
- Micro-timing variations and harmonic content adjustments for AI evasion
- Naturalistic noise addition in quiet sections

### Validation Checks Added
- Audio content validation before each processing stage
- Amplitude and RMS checks to detect silent outputs
- Per-channel validation for stereo processing
- Filter stability checks for short audio segments

## Contributing

When contributing to this project:
1. Fork the repository
2. Create your feature branch (`git checkout -b feature/amazing-feature`)
3. Follow secure coding practices
4. Maintain comprehensive error handling
5. Document security considerations
6. Commit your changes (`git commit -m 'Add some amazing feature'`)
7. Push to the branch (`git push origin feature/amazing-feature`)
8. Open a Pull Request

## License

This project is licensed under the MIT License - see the LICENSE file for details.

## Disclaimer

This tool is intended for legitimate privacy protection purposes. Users are responsible for ensuring they comply with all applicable laws and terms of service when using this software. The authors do not condone or support any illegal activities.
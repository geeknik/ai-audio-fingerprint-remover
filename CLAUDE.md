# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Project Overview

AI Audio Fingerprint Remover is a Python-based defensive security tool designed to remove AI-generated fingerprints, watermarks, and metadata from audio files. The tool implements multiple detection and removal techniques to address privacy concerns while preserving audio quality.

**Key Purpose**: Privacy protection through comprehensive AI fingerprint removal from audio files generated by platforms like Suno, OpenAI, ElevenLabs, and others.

## Architecture

### Core Components

- **ai_audio_fingerprint_remover.py**: Main entry point with comprehensive multi-layered fingerprint removal
- **aggressive_watermark_remover.py**: Specialized aggressive removal techniques
- **sota_watermark_remover.py**: State-of-the-art removal algorithms
- **enhanced_suno_detector.py**: Suno-specific watermark detection
- **advanced_watermark_analysis.py**: Advanced spectral analysis tools
- **watermark_effectiveness_tester.py**: Testing framework for validation

### Processing Pipeline

The tool implements a 4-pass approach:
1. **Metadata Stripping**: Complete removal of standard and custom tags
2. **Spectral Analysis**: Watermark detection and targeted filtering
3. **Statistical Normalization**: Machine-like pattern correction
4. **Human-like Imperfections**: Addition of subtle variations

### Key Libraries

- **librosa**: Audio analysis and processing
- **scipy**: Signal processing and filtering
- **numpy**: Numerical operations
- **soundfile**: Audio I/O operations
- **mutagen**: Metadata manipulation

## Development Commands

### Environment Setup
```bash
# Create and activate virtual environment
python3 -m venv venv && source venv/bin/activate

# Install dependencies
pip install -r requirements.txt
```

### Running the Tool
```bash
# Basic usage
python ai_audio_fingerprint_remover.py input.wav output.wav

# Processing levels
python ai_audio_fingerprint_remover.py input.wav output.wav --level [gentle|moderate|aggressive|extreme]

# Directory processing
python ai_audio_fingerprint_remover.py --directory input_folder output_folder

# With verification and reporting
python ai_audio_fingerprint_remover.py input.wav output.wav --verify --report
```

### Testing
```bash
# Run comprehensive test suite
python test_all_methods.py

# Effectiveness testing
python watermark_effectiveness_tester.py input.wav
```

### Analysis Tools
```bash
# Watermark comparison
python watermark_comparison.py file1.wav file2.wav

# Quick comparison
python quick_comparison.py input.wav
```

## File Structure

### Main Scripts
- Core processing tools implement the AudioProcessor class with chunked processing
- Each script supports command-line operation with comprehensive argument parsing
- Memory-aware processing with adaptive caching for large files

### Test Files
- Various `.wav` output files represent test results from different processing methods
- `test_all_methods.py` provides comprehensive testing across all removal techniques
- `watermark_effectiveness_tester.py` validates removal effectiveness

### Configuration
- Processing intensity levels: gentle, moderate, aggressive, extreme
- Configurable via command-line arguments
- Memory usage and performance monitoring built-in

## Important Notes

### Security Considerations
- This is a defensive security tool for privacy protection
- All processing occurs locally - no external data transmission
- Tool is designed for legitimate privacy protection, not circumventing copyright

### Performance
- Implements chunked processing for memory efficiency
- 30% faster processing with 40% less memory usage for large files
- Adaptive filtering based on file characteristics
- Built-in performance monitoring

### Quality vs. Effectiveness Trade-offs
- Processing levels balance fingerprint removal thoroughness with audio quality
- Extreme levels may introduce subtle artifacts
- Verification tools help assess effectiveness vs. quality impact

## Recent Fixes Applied

### Critical Issues Resolved
1. **Silent Output Fix**: Fixed `np.zeros_like()` initialization that created silent outputs
2. **NaN/Inf Handling**: Replaced aggressive `nan_to_num()` with safe interpolation
3. **Audio Validation**: Added validation checks before file writing to prevent silent outputs
4. **Filter Length Issues**: Fixed filter order calculations to prevent processing failures
5. **AI Detection Bypass**: Enhanced pattern disruption techniques for better evasion

### Audio Processing Improvements
- Fallback mechanisms to preserve original audio if processing fails
- Conservative filtering strengths to maintain audio quality
- Enhanced stereo channel processing with per-channel validation
- Micro-timing variations and harmonic content adjustments for AI evasion
- Naturalistic noise addition in quiet sections

### Validation Checks Added
- Audio content validation before each processing stage
- Amplitude and RMS checks to detect silent outputs
- Per-channel validation for stereo processing
- Filter stability checks for short audio segments